@model GameResult

<form id="RollDiceRequestForm" asp-controller="GameTracker" asp-action="RollDice" method="post"></form>
<form id="UpdatePointsForm" asp-controller="GameTracker" asp-action="SavePointsUpdates">
    <input type="hidden" name="GameId" value="@Model.Id" />
</form>

<input type="hidden" name="GameId" id="RollDiceGameId" value="@Model.Id" />

<div class="row justify-content-center">
    <div class="col-sm-12 col-md-6 text-center">
        @{
            var orderedData = Model.GamePlayData.OrderBy(x => x.Id).ToList();
        }
        @for (var i = 0; i < orderedData.Count; i++)
        {
            var gameData = orderedData[i];

            <h3>@gameData.PlayerData.FirstName @gameData.PlayerData.LastName</h3>
            <h5>@gameData.PlayerFaction.Name</h5>
            <h4>Points:</h4>
            <input form="UpdatePointsForm" type="hidden" name="GameData[@i].Id" value="@gameData.Id" />
            <input form="UpdatePointsForm" type="number" step="1" name="GameData[@i].Points" class="form-control" id="playerData_@gameData.Id" value="@gameData.Points" />
            <hr />
        }
        <button class="btn btn-outline-success" form="UpdatePointsForm" type="submit">Apply Updates</button>
    </div>
</div>
<hr />
<div class="row justify-content-center">
    <div class="col-md-6 text-center">
        <div class="d-grid gap-2">
            <button id="RollDiceButton" class="btn btn-lg btn-block btn-outline-primary" data-bs-toggle="modal" data-bs-target="#RollDiceModal">
                Roll Dice
            </button>
        </div>
    </div>
</div>
<div class="modal fade" id="RollDiceModal" tabindex="-1" aria-labelledby="RollDiceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="RollDiceModalLabel">Quick Roll Dice</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="RollDiceRequestDiv">
                    <div class="mb-3">
                        <label for="AttackCountInput" class="form-label">Attacks Count</label>
                        <input form="RollDiceRequestForm" name="request.DiceCount" type="number" step="1" min="1" class="form-control" id="AttackCountInput" aria-describedby="AttackCountHelp">
                        <div id="AttackCountHelp" class="form-text">The number of dice to roll initially, usually the A (attacks) characteristic.</div>
                    </div>
                    <div class="mb-3">
                        <label for="HitThresholdInput" class="form-label">Hit Threshold</label>
                        <input form="RollDiceRequestForm" name="request.HitThreshold" type="number" step="1" min="1" max="6" class="form-control" id="HitThresholdInput" aria-describedby="HitThresholdHelp">
                        <div id="HitThresholdHelp" class="form-text">The minimum value required on a die to be considered a successful Hit.</div>
                    </div>
                    <div class="mb-3">
                        <label for="WoundThresholdInput" class="form-label">Wound Threshold</label>
                        <input form="RollDiceRequestForm" name="request.WoundThreshold" type="number" step="1" min="1" max="6" class="form-control" id="WoundThresholdInput" aria-describedby="WoundThresholdHelp">
                        <div id="WoundThresholdHelp" class="form-text">The minimum value required on a die to be considered a successful Wound.</div>
                    </div>
                    <div class="mb-3">
                        <label for="SaveThresholdInput" class="form-label">Save Threshold</label>
                        <input form="RollDiceRequestForm" name="request.SaveThreshold" type="number" step="1" min="1" max="6" class="form-control" id="SaveThresholdInput" aria-describedby="SaveThresholdHelp">
                        <div id="SaveThresholdHelp" class="form-text">The minimum value required on a die to be considered a successful Save.</div>
                    </div>
                    <div class="mb-3 form-check">
                        <input form="RollDiceRequestForm" name="request.FeelNoPainFlag" type="checkbox" value="true" class="form-check-input" id="FeelNoPainCheckInput">
                        <label class="form-check-label" for="FeelNoPainCheckInput">Enable Feel No Pain Save?</label>
                    </div>
                    <div class="mb-3">
                        <label for="FNPThresholdInput" class="form-label">Feel No Pain Threshold</label>
                        <input form="RollDiceRequestForm" name="request.FeelNoPainThreshold" type="number" step="1" min="1" max="6" class="form-control" id="FNPThresholdInput" aria-describedby="FNPThresholdHelp">
                        <div id="FNPThresholdHelp" class="form-text">The minimum value required on a die to be considered a successful Feel No Pain Save.</div>
                    </div>
                    <button form="RollDiceRequestForm" type="submit" class="btn btn-primary">Roll!</button>
                </div>
                <div id="RollDiceResultsDiv" style="display: none">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<hr />
<div id="DiceDataSection" style="display: none">

</div>

@section Scripts
{
    <script src="~/lib/microsoft/signalR/dist/browser/signalr.min.js" asp-append-version="true"></script>
    <script src="~/js/RollDiceScripts.js" asp-append-version="true"></script>
    <script src="~/js/OpenGameScripts.js" asp-append-version="true"></script>
    <script src="~/js/GameUpdateHubScripts.js" asp-append-version="true"></script>
}